/*!
 * vuexfire v2.3.0
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexFire={})}(this,function(e){"use strict";function t(e,t){for(var r=0;r<e.length;r++)if(e[r][".key"]===t)return r;return-1}function r(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){return"function"==typeof e.key?e.key():e.key}function i(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function c(e){var t=e.val(),i=r(t)?t:{".value":t};return i[".key"]=n(e),i}function o(e){var t=e.key,r=e.source,n=e.cancelCallback,i=e.commit,o=e.state;return{value:r.on("value",function(e){i(f,{type:f,key:t,record:c(e),state:o},A)},n)}}function a(e){var r=e.key,i=e.source,o=e.cancelCallback,a=e.wait,u=e.commit,s=e.state,f=[],E=function(){u(l,{type:l,state:s,key:r,value:f},A)};a?i.once("value",E):E();var b=i.on("child_added",function(e,n){var i=n?t(f,n)+1:0;u(d,{type:d,state:s,key:r,index:i,array:a&&f,record:c(e)},A)},o),R=i.on("child_removed",function(e){var i=t(f,n(e));u(k,{type:k,state:s,key:r,index:i,array:a&&f},A)},o);return{child_added:b,child_changed:i.on("child_changed",function(e){var i=t(f,n(e));u(y,{type:y,state:s,key:r,index:i,array:a&&f,record:c(e)},A)},o),child_removed:R,child_moved:i.on("child_moved",function(e,i){var o=t(f,n(e)),l=i?t(f,i)+1:0;u(v,{type:v,state:s,key:r,index:o,newIndex:l+=o<l?-1:0,array:a&&f,record:c(e)},A)},o)}}function u(e){var t=e.state,n=e.commit,c=e.key,u=e.source,f=e.options,l=f.cancelCallback,d=f.readyCallback,y=f.errorCallback,v=f.wait;if(void 0===v&&(v=!0),!r(u))throw new Error("VuexFire: invalid Firebase binding source.");if(!(c in t))throw new Error("VuexFire: cannot bind undefined property '"+c+"'. Define it on the state first.");var k=_.get(n);k||(k={sources:Object.create(null),listeners:Object.create(null)},_.set(n,k)),c in k.sources&&s({commit:n,key:c}),k.sources[c]=i(u),(d||y)&&u.once("value",d,y);var E;E=t[c]&&"length"in t[c]?a({key:c,source:u,cancelCallback:l,wait:v,commit:n,state:t}):o({key:c,source:u,cancelCallback:l,commit:n,state:t}),k.listeners[c]=E}function s(e){var t=e.commit,r=e.key,n=_.get(t);if(n||(n={sources:Object.create(null),listeners:Object.create(null)},_.set(t,n)),!(r in n.sources))throw new Error("VuexFire: cannot unbind '"+r+"' because it wasn't bound.");var i=n.sources[r],c=n.listeners[r];for(var o in c)i.off(o,c[o]);delete n.sources[r],delete n.listeners[r]}var f="vuexfire/OBJECT_VALUE",l="VUEXFIRE_ARRAY_INITIALIZE",d="vuexfire/ARRAY_ADD",y="vuexfire/ARRAY_CHANGE",v="vuexfire/ARRAY_MOVE",k="vuexfire/ARRAY_REMOVE",E=Object.freeze({VUEXFIRE_OBJECT_VALUE:f,VUEXFIRE_ARRAY_INITIALIZE:l,VUEXFIRE_ARRAY_ADD:d,VUEXFIRE_ARRAY_CHANGE:y,VUEXFIRE_ARRAY_MOVE:v,VUEXFIRE_ARRAY_REMOVE:k}),b={};b[f]=function(e,t){var r=t.key,n=t.record;e[r]=n},b[l]=function(e,t){var r=t.key,n=t.value;e[r]=n},b[d]=function(e,t){var r=t.key,n=t.index,i=t.record,c=t.array;(c=c||e[r]).splice(n,0,i)},b[y]=function(e,t){var r=t.key,n=t.index,i=t.record,c=t.array;(c=c||e[r]).splice(n,1,i)},b[v]=function(e,t){var r=t.key,n=t.index,i=t.newIndex,c=t.array;(c=c||e[r]).splice(i,0,c.splice(n,1)[0])},b[k]=function(e,t){var r=t.key,n=t.index,i=t.array;(i=i||e[r]).splice(n,1)};var R={};Object.keys(E).forEach(function(e){var t=E[e];R[t]=function(e,r){b[t](r.state,r)}});var A={root:!0},_=new WeakMap;e.firebaseMutations=R,e.firebaseAction=function(e){return function(t,r){var n=t.state,i=t.commit;return t.bindFirebaseRef=function(e,t,r){return void 0===r&&(r={}),u({state:n,commit:i,key:e,source:t,options:r})},t.unbindFirebaseRef=function(e){return s({commit:i,key:e})},e(t,r)}},Object.defineProperty(e,"__esModule",{value:!0})});